<%
include("/jagg/jagg.jag");
include("/jagg/constants.jag");
include("/jagg/config_reader.jag");
(function () {
    var mod, result, returnObj,
            action = request.getParameter("action"),
            tenantPassword = request.getParameter("tenantPassword"),
            site = require("/site/conf/site.json");
    mod = jagg.module("monetizing");
    var cloudConfig = jagg.module("util").getJsonFromFile(CLOUD_MGT_CONFIG_FILE);
    var cloudmgtURI = cloudConfig.ServerUrls.cloudmgt.toString();
    var contactUsURL = cloudmgtURI + CLOUD_CONTACT_US_URI;
    var tenantDomain = (session.get("TENANT_INFO")).tenantDomain;
    if (action == "enableMonetization") {
        if (jagg.module("permission").hasTenantLevelUserMgtPermission()) {
            result = mod.enableMonetization(tenantPassword);
            if (result == null || result.error) {
                var message = result.message;
                if (message == null) {
                    message = "An error occurred while enabling the monetization of the tenant: " + tenantDomain;
                }
                response.status = 500;
                print ({
                    error: true,
                    message: message,
                    status: result.status,
                    account: result.account,
                    redirectionURL: contactUsURL
                });
            } else {
                print(result);
            }
        } else {
            var msg = "User do not have permission to enable the monetization of tenant :" + tenantDomain;
            response.status = 401;
            print({
                error: true,
                message: msg,
                status: "400"
            });
        }
    } else {
        response.status = 401;
        msg = "Invalid action: " + action;
        print({
            error: true,
            message: msg,
            status: "400"
        });
    }
}());
%>
